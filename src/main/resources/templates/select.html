<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Selection Preview</title>
    <link rel="stylesheet" href="/css/app.css" />
    <style>
      .wrap {
        max-width: 1180px;
        margin: 36px auto;
        padding: 0 16px;
      }
      .grid-2 {
        display: grid;
        grid-template-columns: 1.1fr 0.9fr;
        gap: 18px;
      }
      @media (max-width: 980px) {
        .grid-2 {
          grid-template-columns: 1fr;
        }
      }

      .card {
        background: #fff;
        border: 1px solid #e7e9f0;
        border-radius: 16px;
        box-shadow: 0 10px 25px rgba(17, 24, 39, 0.04);
      }
      .card-header {
        padding: 16px 18px 0 18px;
      }
      .card-body {
        padding: 12px 18px 18px 18px;
      }

      .muted {
        color: #6b7280;
      }
      .chip {
        display: inline-flex;
        align-items: center;
        gap: 6px;
        padding: 2px 8px;
        border: 1px solid #e4e7ef;
        border-radius: 999px;
        background: #f2f4f8;
        font-size: 0.82rem;
      }

      /* Mode section */
      .mode-card {
        margin-bottom: 18px;
      }
      .mode-badge {
        font-size: 0.8rem;
        padding: 2px 8px;
        border-radius: 999px;
        background: #e9f7ef;
        color: #067047;
        border: 1px solid #c9f0df;
      }
      .mode-option {
        display: flex;
        gap: 12px;
        align-items: flex-start;
        border: 1px solid #e7e9f0;
        border-radius: 12px;
        padding: 14px;
        margin: 10px 0;
        background: #fff;
      }
      .mode-option input {
        margin-top: 3px;
      }
      .mode-title {
        font-weight: 700;
        margin: 0 0 2px 0;
      }
      .mode-desc {
        margin: 0;
        color: #6b7280;
      }

      /* Left: Packages */
      .section-title {
        display: flex;
        align-items: center;
        justify-content: space-between;
        gap: 12px;
        margin-bottom: 6px;
      }
      .choose-badge {
        background: linear-gradient(135deg, #c4b5fd, #a78bfa);
        color: #fff;
        border-radius: 999px;
        padding: 6px 12px;
        font-weight: 700;
        font-size: 0.9rem;
      }
      .select-all {
        display: flex;
        align-items: center;
        gap: 8px;
        margin: 8px 0 10px 2px;
      }

      .tree-box {
        border: 1px solid #e7e9f0;
        border-radius: 14px;
        padding: 10px;
        max-height: 48vh;
        overflow: auto;
        background: #fff;
      }

      /* Right: PlantUML panel */
      .puml-title {
        display: flex;
        align-items: center;
        gap: 10px;
      }
      .puml-badge {
        background: #ffe5ef;
        color: #9b1c50;
        border: 1px solid #ffd0e3;
        border-radius: 999px;
        padding: 2px 8px;
        font-size: 0.82rem;
      }
      .file-pill {
        display: inline-flex;
        align-items: center;
        gap: 6px;
        border: 1px solid #e7e9f0;
        background: #f8fafc;
        border-radius: 12px;
        padding: 6px 10px;
        font-size: 0.9rem;
      }

      /* Sticky actions */
      .actions-bar {
        position: sticky;
        bottom: 0;
        background: #fff;
        border-top: 1px solid #e7e9f0;
        padding: 14px 18px;
        display: flex;
        gap: 10px;
        justify-content: center;
        z-index: 6;
        box-shadow: 0 -8px 22px rgba(17, 24, 39, 0.06);
      }
      .btn {
        border: none;
        border-radius: 12px;
        padding: 10px 16px;
        font-weight: 600;
        cursor: pointer;
        transition: 0.18s ease;
        display: inline-flex;
        align-items: center;
        gap: 8px;
      }
      .btn:hover {
        transform: translateY(-1px);
      }
      .btn.primary {
        background: linear-gradient(135deg, #14b8a6, #0ea5a3);
        color: #fff;
      }
      .btn.primary:hover {
        background: linear-gradient(135deg, #0ea5a3, #0d9488);
      }
      .btn.lavender {
        background: linear-gradient(135deg, #c4b5fd, #a78bfa);
        color: #fff;
      }
      .btn.lavender:hover {
        background: linear-gradient(135deg, #a78bfa, #8b5cf6);
      }
      .btn[disabled] {
        opacity: 0.55;
        cursor: not-allowed;
        transform: none;
      }

      /* Inline warning when no class selected */
      .inline-warning {
        font-size: 0.9rem;
        color: #b91c1c;
        display: none;
      }
      .inline-warning.show {
        display: inline-flex;
        gap: 6px;
        align-items: center;
      }
    </style>
  </head>
  <body>
    <header class="app-header">
      <h1 class="app-title">Selection Preview</h1>
      <p class="app-subtitle">
        Pick the packages/classes you want to include before parsing
      </p>
    </header>

    <main class="wrap">
      <!-- MODE SELECTION -->
      <section class="card mode-card">
        <div class="card-header">
          <span class="mode-badge">Mode</span>
          <h2 style="margin: 6px 0 0 0">Comparison Options</h2>
        </div>
        <div class="card-body">
          <!-- STRICT -->
          <label class="mode-option">
            <input
              type="radio"
              name="mode"
              value="STRICT"
              form="select-form"
              th:checked="${mode} == 'STRICT'"
            />
            <div>
              <p class="mode-title">Strict (exact)</p>
              <p class="mode-desc">
                UML must match code exactly (classes, members, and
                relationships). Any difference is an error.
              </p>
            </div>
          </label>

          <!-- RELAXED -->
          <label class="mode-option">
            <input
              type="radio"
              name="mode"
              value="RELAXED"
              form="select-form"
              th:checked="${mode} == 'RELAXED' or ${mode} == null"
            />
            <div>
              <p class="mode-title">Relaxed (relationships)</p>
              <p class="mode-desc">
                Classes/members are evaluated like Strict; relationship
                differences are downgraded to warnings.
              </p>
            </div>
          </label>

          <!-- MINIMAL -->
          <label class="mode-option">
            <input
              type="radio"
              name="mode"
              value="MINIMAL"
              form="select-form"
              th:checked="${mode} == 'MINIMAL'"
            />
            <div>
              <p class="mode-title">Minimal (members optional)</p>
              <p class="mode-desc">
                Members may be omitted (suggestions/infos). If written,
                types/params/return/visibility must match exactly. Relationships
                behave like Relaxed.
              </p>
            </div>
          </label>
        </div>
      </section>

      <!-- CONTENT GRID -->
      <form id="select-form" th:action="@{/select/confirm}" method="post">
        <input type="hidden" name="workspaceRoot" th:value="${workspaceRoot}" />
        <input type="hidden" name="codeOnly" th:value="${codeOnly}" />

        <div class="grid-2">
          <!-- LEFT: PACKAGES & CLASSES -->
          <section class="card">
            <div class="card-body">
              <div class="section-title">
                <h2 style="margin: 0">Packages &amp; Classes</h2>
                <span class="choose-badge">Choose</span>
              </div>

              <!-- Select all + warning -->
              <div class="select-all">
                <input type="checkbox" id="selectAll" />
                <label for="selectAll">Select all</label>

                <span id="needOne" class="inline-warning">
                  <span
                    style="
                      width: 8px;
                      height: 8px;
                      background: #ef4444;
                      border-radius: 50%;
                      display: inline-block;
                    "
                  ></span>
                  Select at least one class to continue
                </span>
              </div>

              <div class="tree-box" id="tree">
                <!-- scanMap: Map<String,List<String>> (package -> class simple names) -->
                <div class="pkg" th:each="entry : ${scanMap}">
                  <!-- Package header -->
                  <div
                    style="
                      display: flex;
                      align-items: center;
                      gap: 10px;
                      margin: 6px 0;
                    "
                  >
                    <input
                      type="checkbox"
                      class="pkg-checkbox"
                      th:attr="data-pkg=${entry.key}"
                    />
                    <div style="font-weight: 700" th:text="${entry.key}">
                      a.b.c
                    </div>
                    <span
                      class="chip"
                      th:text="${#lists.size(entry.value)} + ' classes'"
                      >0 classes</span
                    >
                  </div>

                  <!-- Package classes -->
                  <div style="margin: 2px 0 10px 28px">
                    <div
                      th:each="cls : ${entry.value}"
                      style="
                        display: flex;
                        align-items: center;
                        gap: 10px;
                        margin: 6px 0;
                      "
                    >
                      <input
                        type="checkbox"
                        class="cls-checkbox"
                        name="selectedFqcns"
                        th:value="${entry.key} != '(default package)' ? ${entry.key + '.' + cls} : ${cls}"
                      />
                      <span
                        style="
                          width: 8px;
                          height: 8px;
                          background: #3b82f6;
                          border-radius: 50%;
                          display: inline-block;
                        "
                      ></span>
                      <span th:text="${cls + '.java'}">MyClass.java</span>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </section>

          <!-- RIGHT: PLANTUML (only if not code-only) -->
          <section class="card" th:if="${!codeOnly}">
            <div class="card-body">
              <div class="puml-title">
                <span class="puml-badge">PlantUML</span>
                <h2 style="margin: 0">Scripts</h2>
                <span
                  class="chip"
                  th:text="${plantumlNames != null ? #lists.size(plantumlNames) : 0} + ' file(s)'"
                  >0 file(s)</span
                >
              </div>

              <div
                style="
                  border: 1px solid #e7e9f0;
                  border-radius: 14px;
                  padding: 10px;
                  margin-top: 10px;
                "
              >
                <div
                  th:each="n : ${plantumlNames}"
                  class="file-pill"
                  style="margin: 6px 6px 0 0"
                >
                  <span
                    style="
                      width: 8px;
                      height: 8px;
                      background: #10b981;
                      border-radius: 50%;
                      display: inline-block;
                    "
                  ></span>
                  <span th:text="${n}">diagram.puml</span>
                </div>
                <p
                  class="muted"
                  style="margin-top: 8px"
                  th:if="${plantumlNames == null || #lists.isEmpty(plantumlNames)}"
                >
                  No PlantUML scripts provided.
                </p>
              </div>
            </div>
          </section>
        </div>

        <!-- Sticky actions -->
        <div class="actions-bar">
          <a class="btn lavender" th:href="@{/}">Back</a>
          <button id="continue-btn" class="btn primary" type="submit">
            Continue
          </button>
        </div>
      </form>
    </main>

    <script src="/js/select.js?v=42" defer></script>
  </body>
</html>
